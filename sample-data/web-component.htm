<script>
  const template = document.createElement('template');
  template.innerHTML = `
<style>
:host {
  margin-bottom: 10px;
  display: grid;
  grid-template-areas: "t t t" "l m r" "b b b";
  grid-template-columns: 5% 90% 5%;
  grid-template-rows: 5% 90% 5%;
  grid-gap: 0;
  font-family: sans-serif;
}

* {
  box-sizing: border-box;
}

#field {
  display: grid;
  grid-template-areas: "a";
  gap: 1px;
  grid-area: m;
  border: 1px solid grey;
}

#field.invalid {
  box-shadow: 0 0 15px 5px #FF8D8D;
}

.field {
  background-color: lime;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
}

.field:hover {
  background: darkgreen;
}

.field.selected {
  color: silver;
  background: darkred;
}

.field.selected:hover {
  background: red;
}

#label-top {
  grid-area: t
}

#label-bottom {
  grid-area: b
}

#label-left {
  grid-area: l
}

#label-right {
  grid-area: r
}

#label-left,
#label-right,
#label-top,
#label-bottom {
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: x-small;
}

#label-left-content {
  white-space: nowrap;
  transform: rotate(-90deg);
}

#label-right-content {
  transform: rotate(90deg);
  white-space: nowrap;
}
</style>
<div id="label-top"><span id="label-top-content"></span></div>
<div id="label-left"><span id="label-left-content"></span></div>
<div id="field"></div>
<div id="label-right"><span id="label-right-content"></span></div>
<div id="label-bottom"><span id="label-bottom-content"></span></div>
`;

  class FormField extends HTMLElement {
    static observedAttributes = [
      "size",
      "label-top",
      "label-bottom",
      "label-left",
      "label-right",
      "labels",
      "value",
      "name",
      "inner-style",
      "required"
    ];

    constructor() {
      super();

      this._shadowRoot = this.attachShadow({
        'mode': 'open'
      });
      this._shadowRoot.appendChild(template.content.cloneNode(true));

      this.$field = this.shadowRoot.querySelector("#field");
      this.$labelTop = this.shadowRoot.querySelector("#label-top-content");
      this.$labelBottom = this.shadowRoot.querySelector("#label-bottom-content");
      this.$labelLeft = this.shadowRoot.querySelector("#label-left-content");
      this.$labelRight = this.shadowRoot.querySelector("#label-right-content");
      this.$style = this.shadowRoot.querySelector("style");
      this.labels = null;
      this.required = false;
    }

    attributeChangedCallback(name, oldValue, newValue) {
      switch (name) {
        case "size":
          this._createFields(newValue);
          break;
        case "labels":
          try {
            this.labels = JSON.parse(newValue);
          } catch (e) {
            this.labels = '';
          }
          this._updateFieldLabels();
          break;
        case "label-top":
          this.$labelTop.innerText = newValue;
          break;
        case "label-bottom":
          this.$labelBottom.innerText = newValue;
          break;
        case "label-left":
          this.$labelLeft.innerText = newValue;
          break;
        case "label-right":
          this.$labelRight.innerText = newValue;
          break;
        case "inner-style":
          this.$style.innerHTML += newValue;
          break;
        case "required":
          this.required = true;
          this._updateValue(this.getAttribute('value'));
        case "value":
          if (oldValue !== newValue) {
            this._updateValue(newValue);
          }
          break;
      }
    }

    _createFields(size) {
      this.$field.innerText = '';
      this.$field.style.gridTemplateAreas = '"' + Array.from({ length: size }).map(_ => 'a').join(' ') + '"';
      const to = (Math.floor(size / 2));
      const from = -1 * to;
      const isOdd = !!(size % 2);
      for (let i = from; i <= to; i++) {
        if (!isOdd && !i) continue;
        for (let j = from; j <= to; j++) {
          if (!isOdd && !j) continue;
          this.$field.appendChild(this._createField(i, j));
        }
      }
    }
    _createField(x, y) {
      const field  = document.createElement('div');
      field.className = 'field quadrant-' + this._getQuadrantNumber(x, y);
      field.dataset.value = this._getFieldValue(x, y);
      field.innerText = this._getFieldLabel(x, y);
      field.addEventListener('click', () => {
        this._updateValue(field.dataset.value === this.getAttribute('value') ? '' : field.dataset.value);
      });
      return field;
    }
    _getQuadrantNumber(x, y) {
      switch (`${Math.sign(x)}, ${Math.sign(y)}`) {
        case "1, 1": return 1;
        case "-1, 1": return 2;
        case "-1, -1": return 3;
        case "1, -1": return 4;
        default: return 0;
      }
    }
    _getFieldValue(x, y) {
      return `${x}, ${y}`;
    }
    _getCoordinatesFromValue(fieldValue) {
      return fieldValue.split(',').map(s => parseInt(s.trim()));
    }
    _getFieldLabel(x, y) {
      if (this.labels != null) {
        if (this.labels[x] && this.labels[x][y]) {
          return this.labels[x][y];
        } else {
          return "";
        }
      }
      return this._getFieldValue(x, y);
    }
    _updateValue(value) {
      this.$field.classList.remove('invalid');
      this.$field.querySelectorAll('.field.selected')
        .forEach(field => field.classList.remove('selected'));
      const selectedField = this.$field.querySelector(`.field[data-value="${value}"]`);

      if (!selectedField) {
        if (this.required) {
          this.$field.classList.add('invalid');
        }
        this._changeValue(null);
        return;
      }
      selectedField.classList.add('selected');
      this._changeValue(value);
    }
    _changeValue(toValue) {
      this.setAttribute('value', toValue);
      this.dispatchEvent(new CustomEvent('change', { bubbles: true }));
    }
    _updateFieldLabels() {
      this._shadowRoot.querySelectorAll(`.field`)
        .forEach(field => {
          if (!field.dataset) {
            return;
          }
          const xy = this._getCoordinatesFromValue(field.dataset.value);
          field.innerText = this._getFieldLabel(...xy)
        });
    }
  }
  window.customElements.define('two-dimensional', FormField);
</script>

<h1>Custom Web-Element</h1>
<p>This unit contains a WebComponent for two-dimensional scales. It is *not*designed as a form-element, because
  the simple player should handle every element with `name` and `value` as item.
</p>
<two-dimensional
    size="4"
    label-top="top"
    label-left="left"
    label-right="right"
    label-bottom="bottom"
    name="first_example"
    required
    style="height: 500px; width: 500px"
></two-dimensional>
<button onclick="alert(document.getElementsByName('first_example')[0].getAttribute('value')); return false">Get Value</button>
<hr>
<p>It can have various styles, sizes and labels.</p>
<two-dimensional
    id="labels"
    size="2"
    label-top="top"
    label-left="left"
    label-right="right"
    label-bottom="bottom"
    name="second_example"
    value="1, 1"
    inner-style=".field {color: white} .quadrant-1.field { background: dodgerblue } .quadrant-2.field { background: red } .quadrant-3.field { background: seagreen } .quadrant-4.field { background: yellow } .field.selected, .field:hover { box-shadow: inset 0px 0px 15px 5px #000000;}",
    style="height: 150px; width: 150px; background: black; color: white"
    labels='{"-1": { "-1" : "A", "1": "B" }, "1": { "-1" : "C", "1": "D" }}'
></two-dimensional>
<button onclick="alert(document.getElementsByName('second_example')[0].getAttribute('value')); return false">Get Value</button>
<hr>
<two-dimensional
    size="21"
    label-top="Authoritarian"
    label-left="Left"
    label-right="Right"
    label-bottom="Libertarian"
    name="political_compass"
    value="0, 0"
    style="height: 500px; width: 500px"
    inner-style=".field {background: silver} .quadrant-1.field { background: #42aaff } .quadrant-2.field { background: #c09aea } .quadrant-3.field { background: #99ed97 } .quadrant-4.field { background: #ff7575 } .field.selected, .field:hover { box-shadow: inset 0px 0px 15px 5px #000000;}",
    labels=""
></two-dimensional>
<p>Inspired by <a href="https://www.politicalcompass.org/">politicalcompass.org</a></p>
<input name=".d[">